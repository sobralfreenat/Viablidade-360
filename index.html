<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Imagem e Círculos Rotativos</title>
  <style>
    .container {
      position: relative;
      width: 600px; /* Container maior */
      height: 600px; /* Container maior */
      border: 1px solid transparent;
      overflow: hidden;
    }
    .image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform-origin: center center;
      transition: transform 0.5s ease;
    }
    .circle {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      position: absolute;
      cursor: pointer;
      left: 10px; /* Ajuste para o canto esquerdo */
      top: 10px; /* Ajuste para o canto superior */
    }
    .verde { background-color: green; }
    .azul { background-color: blue; }
    .amarelo { background-color: yellow; }
    .vermelho { background-color: red; }

    .controls {
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img class="image" src="https://d1yei2z3i6k35z.cloudfront.net/6682800/65d82286182f9_viabilidde360source.png" alt="Imagem" style="width: 100%; height: auto;"> <!-- Ajuste de tamanho da imagem -->
    <div class="circle verde"></div>
    <div class="circle azul" style="top: 40px;"></div>
    <div class="circle amarelo" style="top: 70px;"></div>
    <div class="circle vermelho" style="top: 100px;"></div>
  </div>

  <div class="controls">
    <label for="rotationInput">Ângulo de Rotação:</label>
    <input type="number" min="-360" max="360" step="1" value="0" id="rotationInput">
    <input type="range" min="-360" max="360" value="0" id="rotationRange">
  </div>
  
  <div class="controls">
    <label for="sizeRange">Tamanho dos Círculos:</label>
    <input type="range" min="10" max="50" value="20" id="sizeRange">
  </div>

  <div class="controls">
    <label for="fileInput">Escolher Arquivo:</label>
    <input type="file" id="fileInput">
  </div>

  <button id="showHidden">Mostrar Ocultos</button>
  <button id="resetHidden">Reiniciar Ocultos</button>

  <script>
    const container = document.querySelector('.container');
    const rotationInput = document.getElementById('rotationInput');
    const rotationRange = document.getElementById('rotationRange');
    const sizeRange = document.getElementById('sizeRange');
    const fileInput = document.getElementById('fileInput');
    const showHiddenButton = document.getElementById('showHidden');
    const resetHiddenButton = document.getElementById('resetHidden');

    const colors = ['verde', 'azul', 'amarelo', 'vermelho'];
    let colorIndex = 0;

    // Mostrar círculos ocultos ao clicar no botão
    showHiddenButton.addEventListener('click', () => {
      createHiddenCircles(4); // Criar um novo conjunto de círculos ocultos
    });

    // Reiniciar círculos ocultos ao clicar no botão
    resetHiddenButton.addEventListener('click', () => {
      resetHiddenCircles();
    });

    // Função para criar círculos ocultos
    function createHiddenCircles(count) {
      for (let i = 0; i < count; i++) {
        const newCircle = document.createElement('div');
        newCircle.className = `circle ${colors[colorIndex]} hidden`;
        newCircle.style.top = `${10 + i * 30}px`;
        container.appendChild(newCircle);
        colorIndex = (colorIndex + 1) % colors.length;
        makeDraggable(newCircle); // Adiciona a lógica de arrastar ao novo círculo oculto
      }
    }

    // Função para reiniciar círculos ocultos
    function resetHiddenCircles() {
      const hiddenCircles = document.querySelectorAll('.circle.hidden');
      hiddenCircles.forEach(circle => {
        circle.style.visibility = 'visible'; // Tornar os círculos visíveis
        circle.classList.remove('hidden'); // Remover a classe 'hidden'
      });
    }

    // Função para tornar os círculos arrastáveis
    function makeDraggable(circle) {
      circle.addEventListener('mousedown', startDrag);
      circle.addEventListener('click', deleteCircle); // Adiciona a funcionalidade de exclusão ao clicar
    }

    // Função para iniciar o arrasto do círculo
    function startDrag(event) {
      if (event.target.classList.contains('circle')) {
        event.preventDefault();
        const circle = event.target;
        const offsetX = event.clientX - circle.getBoundingClientRect().left;
        const offsetY = event.clientY - circle.getBoundingClientRect().top;

        // Função para mover o círculo durante o arrasto
        function moveCircle(event) {
          event.preventDefault();
          const x = event.clientX - offsetX - container.getBoundingClientRect().left;
          const y = event.clientY - offsetY - container.getBoundingClientRect().top;
          circle.style.left = `${x}px`;
          circle.style.top = `${y}px`;
        }

        // Função para parar o arrasto do círculo
        function stopDrag() {
          document.removeEventListener('mousemove', moveCircle);
          document.removeEventListener('mouseup', stopDrag);
        }

        // Adicionar event listeners para o movimento e parada do arrasto
        document.addEventListener('mousemove', moveCircle);
        document.addEventListener('mouseup', stopDrag);
        
        // Verificar se a tecla Ctrl está pressionada
        document.addEventListener('keydown', function(e) {
          if (e.ctrlKey) {
            const clone = circle.cloneNode(true); // Clonar o círculo selecionado
            container.appendChild(clone); // Adicionar o clone ao container
            makeDraggable(clone); // Tornar o clone arrastável
          }
        });
      }
    }

    // Função para excluir um círculo ao clicar nele enquanto a tecla "Alt" está pressionada
    function deleteCircle(event) {
      if (event.altKey && event.target.classList.contains('circle')) {
        event.target.remove();
      }
    }

    // Event listener para alterar a rotação usando o input number
    rotationInput.addEventListener('input', () => {
      const rotationValue = rotationInput.value;
      container.style.transform = `rotate(${rotationValue}deg)`;
      rotationRange.value = rotationValue;
    });

    // Event listener para alterar a rotação usando o input range
    rotationRange.addEventListener('input', () => {
      const rotationValue = rotationRange.value;
      container.style.transform = `rotate(${rotationValue}deg)`;
      rotationInput.value = rotationValue;
    });

    // Event listener para alterar o tamanho dos círculos
    sizeRange.addEventListener('input', () => {
      const newSize = sizeRange.value + 'px';
      const circles = container.querySelectorAll('.circle:not(.hidden)');
      circles.forEach(circle => {
        circle.style.width = newSize;
        circle.style.height = newSize;
      });
    });

    // Event listener para alterar a imagem
    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function(event) {
        const image = container.querySelector('.image');
        image.src = event.target.result;
      };
      reader.readAsDataURL(file);
    });

    // Chamada inicial para criar os círculos ocultos
    createHiddenCircles(4);

  </script>
</body>
</html>
